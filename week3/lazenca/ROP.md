# week3  
## lazenca  
### Return Oriented Programming(ROP)-X86,X64  
  * ROP는 공격자가 실행 공간 보호(NXbit) 및 code signing과 같은 보안 방어가 있는 상태에서 코드를 실행하게 해주는 기술  
    *RTL +Gadgets  
  * 공격자는 프로그램의 흐름을 변경하기 위해 stack overflow 취약성 필요 동시에 "가젯"이라고 하는 해당 프로그램이 사용하는 메모리에 이미 있는 기계 명령어가 필요  
    * 각 가젯은 일반적으로 ret으로 끝이나며 기존 프로그램, 고유 라이브러리 코드 내의 서브 루틴에 존재  
    * 가젯과 취약성을 사용시 공격자가 임의의 작업 수행 가능  
### Gadgets - POP; POP; POP; RET-X86
  * ROP는 기본적으로 rtl 기법을 사용하며 공격자는 rtl과 가젯을 이용해 공격에 필요한 코드를 프로그래밍함  
  * 여러 개의 함수를 호출하기 위해 사용되는 것이 가젯이며 아래와 같은 가젯이 사용됨  
    * 호출하는 함수의 인자가 3개인 경우 : "POP; POP; POP; ret"  
    * 호출하는 함수의 인자가 2개인 경우 : "POP; POP; ret"  
    * 호출하는 함수의 인자가 1개인 경우 : "POP; ret"  
    * 호출하는 함수의 인자가 없는 경우 : "ret"  
  * 해당 가젯들의 역할은 esp 레지스터 값을 증가시키는 것  
    * RTL에 의해 호출되는 함수에 전달되는 인자 값이 저장된 영역을 지나 다음 함수가 호출되도록 하는 것
    * x86에서는 pop 명령어의 피연산자 값이 중요하지 않음  
  * 아래의 방법으로 여러개의 함수를 연속해서 실행가능  
    * RTL에서 호출할 함수의 다음 영역은 return address 영역  
    * 해당 영역에 gadgets의 주소를 저장함으로써 연속해서 다음 함수가 호출될 수 있음  
    * read() 함수 호출 후 system() 함수 호출  
### PLT&GOT-X86  
  * PLT(Procedure linkage table)에는 동적 링커가 공유 라이브러리의 함수를 호출하기 위한 코드가 ".plt" 섹션에 저장되어 있음  
  * GOT(Global offset table)에는 동적 링커에 의해 공유 라이브러리에서 호출할 함수의 주소가 ".got.plt" 섹션에 저장됨  
    * ".got.plt" 섹션은 공격 대상이 되며 주로 힙 ".bss" exploit에 의해 포인터 값을 변조  
  * ROP에서는 해당 정보들을 유용하게 사용가능  
### Gadgets - POP; POP; POP; RET-X64  
  *X64에선 호출 규약 때문에 피연산자가 매우 중요  
    * X86의 호출 규약은 Cdecl(C declaration)이고 x64의 호출 규약은 System VAMD64 ABI임  
    * X64의 rop에서 pop 명령어의 역할은
      * esp 레지스터의 값을 증가시켜 함수를 연속으로 호출하는 것  
      * 호출할 함수에 전달될 인자 값을 레지스터에 저장하는 것
        * 인자 값은 stack에 저장됨  
        * 해당 역할 때문에 필요한 gadget을 찾기가 어려워짐  
      * 아래 형태의 gadgets을 사용
        * 호출할 함수의 첫번째 인자 값을 저장 : "pop rdi; ret"  
        * 호출할 함수의 두번째 인자 값을 저장 : "pop rsi; ret"  
        * 호출할 함수의 첫번째, 세번째 인자 값을 저장 :" pop rdi; pop rdx; ret"  
      *X64에서는 가젯들을 이용하여 인자 값을 레지스터에 저장후 함수를 호출
    
